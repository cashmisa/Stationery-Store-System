@model LUSSIS.Models.WebDTO.SupervisorReportDTO

@{
    ViewBag.Title = "GenerateReport";
}


@Scripts.Render("https://code.jquery.com/jquery-1.12.4.js")
@Scripts.Render("https://code.jquery.com/ui/1.12.1/jquery-ui.js")
<script>
    $(function () {
        $("#datepicker").datepicker();
    });
</script>
<h2>GenerateReport</h2>

<div class="row">
    <div class="col-md-3">
        <br />
        <div class="bs-component">
            <div class="card bg-light mb-3" style="max-height: 10rem; min-width: 15rem; margin-right: 1rem">
                <div class="col-xs-12 text-left">
                    <div class="card text-black">

                        <div class="card-body">

                            <input type="radio" id="This_month" value="This_month" name="date_range" onclick="handleClick(this)" /><label for="This_month">This Month</label>
                            <br />
                            <input type="radio" id="This_year" value="This_year" name="date_range" onclick="handleClick(this)" /><label for="This_year">This Year</label>
                            <br />
                            <input type="radio" id="Past_Three_Months" value="Past_Three_Months" name="date_range" onclick="handleClick(this)" /><label for="Supplier">Past Three Months</label>
                            <br />
                            <input type="radio" id="Past_Six_Months" value="Past_Six_Months" name="date_range" onclick="handleClick(this)" /><label for="Supplier">Past six Months</label>
                            <br />
                            <input type="radio" id="Custom_Range" value="Custom_Range" name="date_range" onclick="handleClick(this)" /><label for="Supplier">Custom Range</label>
                            <br />

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <br />
        <br />
        <div class="bs-component">
            <div class="card bg-light mb-3" style="max-height: 10rem; min-width: 15rem; margin-right: 1rem">
                <div class="col-xs-12 text-left">
                    <div class="card text-black">

                        <div class="card-body">

                            <input type="checkbox" name="chart_or_table" id="BarChart" value="BarChart" onclick="handleClick(this)" /><label for="BarChart">Barchart</label><br />

                            <input type="checkbox" name="chart_or_table" id="Table" value="Table" onclick="handleClick(this)" /><label for="Table">Table</label><br />

                            <input type="checkbox" name="chart_or_table" id="Pie" value="Pie" onclick="handleClick(this)" /><label for="Table">Pie Chart</label><br />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="row">
            <div class="col-md-6">
                <h6>Select Department</h6>
                <select id="select_depart" size="8" onchange="departChange()" multiple>
                    <option value="0">All</option>
                    @foreach (var sup in Model.Department)
                    {
                        <option value="@sup.DeptCode">
                            @sup.DeptName
                        </option>
                    }
                </select>
                <br />
                <br />


            </div>
            <div class="col-md-6" id="notshowCategory">
                <h6>Select Category</h6>

                <select id="select_category" multiple size="8" onchange="categoryChange()">
                    <option value="0">All</option>
                    @foreach (var cat in Model.Categories)
                    {
                        <option value="@cat.CategoryId">
                            @cat.CategoryName
                        </option>
                    }
                </select>



            </div>

            <input type="text" name="daterange" value="01/01/2015 - 01/31/2015" />



            <script type="text/javascript">

                $(function () {

                    $('input[name="daterange"]').daterangepicker();

                });

            </script>
            <div class="col-md-4" id="notshowDate" style="display:none;">
                <p>Date: <input type="text" id="datepicker"></p>
            </div>

        </div>

    </div>
</div>
<input type="hidden" id="hid_depart" name="supplier" />
<input type="hidden" id="hid_category" name="category" />
<input type="hidden" id="hid_date" name="date" />
<input type="submit" value="Generate" id="Generate" onclick="Generate_click()" />
<input type="hidden" id="barchart" name="barchart" />
<input type="hidden" id="table" name="table" />
<input type="hidden" id="pie" name="pie" />
<div class="row">
    <div class="col-md-6">
        <div id="chart_div"></div>
    </div>
    <div class="col-md-6">
        <div id="bar_div"></div>
    </div>

</div>
<div class="row">
    <div class="col-md-6">
        <div id="pie_div"></div>
    </div>
</div>


@Scripts.Render("https://www.gstatic.com/charts/loader.js")


<script>

    function departChange() {
        var values = $('#select_depart').val();
        $('#hid_depart').val(values);


    }
    function categoryChange() {
        var value = $('#select_category').val();

        $('#hid_category').val(value);

    }

    function handleClick(myRadio) {
        var check = $(myRadio).val();


        if (check == "Custom_Range") {
            document.getElementById("notshowDate").style.display = "block";

        }
        if (check == "This_month" || check == "This_year" || check == "Past_Three_Months" || check == "Past_Six_Months") {
            $('#hid_date').val(check);
            document.getElementById("notshowDate").style.display = "none";

        }
        if (check == "BarChart") {
            $('#barchart').val(true);
        }
        if (check == "Table") {
            $('#table').val(true);
        }
        if (check == "Pie") {
            $('#pie').val(true);
        }

    }

    function Generate_click() {

        var depart_values = $('#hid_depart').val();
        var category_values = $('#hid_category').val();

        var date = $('#hid_date').val();
        var barchart = $('#barchart').val();
        var table = $('#table').val();
        var pie = $('#pie').val();

        alert(depart_values);
        alert(category_values);

        getData(depart_values, category_values, date, barchart, table, pie);
    }

    function getData(depart, category, date, barchart, table, pie) {
        $.ajax({
            type: 'GET',
            url: '/SupervisorDashboard/GetDepartmentReportJSON?depart=' + depart + '&&cat=' + category + '&&date=' + date,
            success: function (chartsdata) {

                google.charts.load('current', { 'packages': ['corechart'] });
                if (table) {
                    google.charts.setOnLoadCallback(function () {
                        DrawStackChart();
                    });

                }

                if (barchart) {
                    google.charts.setOnLoadCallback(function () {
                        DrawBarChartLoad(chartsdata);
                    });

                }

                google.charts.setOnLoadCallback(function () {

                    DrawPieChartLoad(chartsdata);


                });

            },
            error: function () {
                alert("Error loading data! Please try again.");
            }
        });
    }


    function DrawPieChartLoad(chartsdata) {
        var first = chartsdata.ListOne;
        var second = chartsdata.ListTwo;

        var data = new google.visualization.DataTable();

        data.addColumn('string', 'CategoryName');
        data.addColumn('number', 'PostCount');

        //Loop through each list data

        for (var i = 0; i < first.length; i++) {
            if (second[i] != 0) {
                data.addRow([first[i], second[i]]);
            }

        }

        // Instantiate and draw our chart, passing in some options
        var chart = new google.visualization.PieChart(document.getElementById('chart_div'));

        //Draw pie chart command with data and chart options
        chart.draw(data,
            {
                title: "Department Trend Analysis",
                position: "top",
                fontsize: "25px",
                width: "600",
                height: "600",
            });

    }
    function DrawBarChartLoad(chartsdata) {
        var first = chartsdata.ListOne;
        var second = chartsdata.ListTwo;

        var data = new google.visualization.DataTable();

        data.addColumn('string', 'CategoryName');
        data.addColumn('number', 'PostCount');

        //Loop through each list data

        for (var i = 0; i < first.length; i++) {
            if (second[i] != 0) {
                data.addRow([first[i], second[i]]);
            }
        }
        var chart = new google.visualization.BarChart(document.getElementById('bar_div'));


        chart.draw(data,
            {
                title: "Department Trend Analysis",
                position: "top",
                fontsize: "25px",
                width: "400",
                height: "600",
            });

    }

    function DrawStackChart() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Topping');
        data.addColumn('number', 'Nescafe Instant');
        data.addColumn('number', 'Folgers Instant');
        data.addColumn('number', 'Nescafe Beans');
        data.addColumn('number', 'Folgers Beans');
        data.addRows([
            ['2001', 321, 621, 816, 319],
            ['2002', 163, 231, 539, 594],
            ['2003', 125, 819, 123, 578],
            ['2004', 197, 536, 613, 298]
        ]);

        // Set chart options
        var options = {
            isStacked: true,
            width: 800,
            height: 600,
            chart: {
                title: 'Year-by-year coffee consumption',
                subtitle: 'This data is not real'
            },
            vAxis: {
                viewWindow: {
                    min: 0,
                    max: 1000
                }
            },
            series: {
                2: {
                    targetAxisIndex: 1
                },
                3: {
                    targetAxisIndex: 1
                }
            }
        };


        var chart = new google.charts.Bar(document.getElementById('pie_div'));
        chart.draw(data, google.charts.Bar.convertOptions(options));

    }
</script>


